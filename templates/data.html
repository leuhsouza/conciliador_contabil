<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Conciliador de Lançamentos Contábeis - Dados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='jquery-3.6.0.min.js') }}"></script>
    <style>
        .highlight {
            background-color: lightgreen;
        }
        .selected {
            background-color: lightblue;
        }
    </style>
</head>
<body>
    <button onclick="voltarParaInicio()">Voltar para Início</button>
    <form method="post">
        <label for="filter_field">Filtro por Histórico:</label>
        <input type="text" id="filter_field" name="filter_field">
        <br>
        <label for="filter_conta">Filtro por Conta Contábil:</label>
        <input type="text" id="filter_conta" name="filter_conta">
        <br>
        <button type="submit">Aplicar Filtro</button>
    </form>
    <script>
        function voltarParaInicio() {
            window.location.href = "{{ url_for('index') }}"; // Gera a URL para a página inicial
        }
    </script>
    <h1>Dados</h1>
    <form action="/download" method="post" enctype="multipart/form-data">
        <input type="file" name="file">
        <input type="submit" value="Download Processed File">
    </form>
    <div>
        <table>
            <thead>
                <tr>
                    <th><a href="{{ url_for('data', order_by='data', order_direction='asc') }}">Data ↑</a> | <a href="{{ url_for('data', order_by='data', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='historico', order_direction='asc') }}">Histórico ↑</a> | <a href="{{ url_for('data', order_by='historico', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='contra_partida', order_direction='asc') }}">Contra Partida ↑</a> | <a href="{{ url_for('data', order_by='contra_partida', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='lote', order_direction='asc') }}">Lote ↑</a> | <a href="{{ url_for('data', order_by='lote', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='lancamento', order_direction='asc') }}">Lançamento ↑</a> | <a href="{{ url_for('data', order_by='lancamento', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='d', order_direction='asc') }}">D ↑</a> | <a href="{{ url_for('data', order_by='d', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='c', order_direction='asc') }}">C ↑</a> | <a href="{{ url_for('data', order_by='c', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='dc', order_direction='asc') }}">D/C ↑</a> | <a href="{{ url_for('data', order_by='dc', order_direction='desc') }}">↓</a></th>
                    <th><a href="{{ url_for('data', order_by='conta', order_direction='asc') }}">Conta ↑</a> | <a href="{{ url_for('data', order_by='conta', order_direction='desc') }}">↓</a></th>
                </tr>
            </thead>
            <tbody>
                {{ table|safe }}
            </tbody>
        </table>
    </div>
    <script>
        $(document).ready(function() {
            let selectedRow = null;

            $('table.data tr').attr('tabindex', 0).on('click', function() {
                if (selectedRow) {
                    $(selectedRow).removeClass('selected');
                }
                selectedRow = this;
                $(this).addClass('selected').focus();
            }).on('dblclick', function() {
                $(this).toggleClass('highlight');
            }).on('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    $(this).toggleClass('highlight');
                }
            });

            $(document).on('keydown', function(event) {
                if (!selectedRow) return;

                let rows = $('table.data tr');
                let index = rows.index(selectedRow);

                if (event.key === 'ArrowDown') {
                    event.preventDefault();
                    if (index < rows.length - 1) {
                        $(selectedRow).removeClass('selected');
                        selectedRow = rows.get(index + 1);
                        $(selectedRow).addClass('selected').focus();
                    }
                } else if (event.key === 'ArrowUp') {
                    event.preventDefault();
                    if (index > 0) {
                        $(selectedRow).removeClass('selected');
                        selectedRow = rows.get(index - 1);
                        $(selectedRow).addClass('selected').focus();
                    }
                }
            });
        });
    </script>
</body>
</html>
